<!doctype html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<html lang="en">
<head>
  <meta charset="utf-8">

  <title>canvas</title>
  <meta name="description" content="The HTML5 Herald">
  <meta name="author" content="SitePoint">

  <link rel="stylesheet" href="css/styles.css?v=1.0">
		<style>
			canvas{			border: 1px solid green;}
		</style>

</head>

<body>
<h1>helloworld</h1>


<div id='status'>
  1/1
</div>
  <canvas id="screen" width="500" height="500">

  </canvas>
  <script type="text/javascript">
  ///setting canvas to window height .
  var score =0;
  var canvas = document.querySelector('canvas');

  console.log("starts");
  window.addEventListener('mousemove',function(event){

  })

  canvas.width = canvas.scrollWidth;
  canvas.height = canvas.scrollHeight ;
  cW =canvas.width;
  cH = canvas.height;
  var c = canvas.getContext('2d'); //sets canvs to 2d
  function Circle(id,x,y,dx,dy,radius,clr) {
   this.x = x;
   this.y = y;
   this.dx = dx;
   this.dy = dy;
   this.radius = radius;
   this.id= id;
   this.clr=clr;

  console.log("xy",x,y);
  //draw





  };
  Circle.prototype.draw = function(){

    c.beginPath();
    c.arc(this.x, this.y, this.radius, 0, 2 * Math.PI,false);
    //c.addHitRegion({ida: 'circle'});
    c.strokeStyle = 'blue';
      c.fillStyle = this.clr;
    c.fill();
    c.stroke();
    c.font = "12px Arial";
  c.strokeText(`${this.id}`, this.x, this.y);
    // console.log("circle drawn");


  };
  Circle.prototype.update = function(){
    if (this.x + this.radius > cW ||this.x - this.radius < 0) {
        this.dx= -this.dx;
    }
     if (this.y + this.radius > cH ||this.y - this.radius < 0) {
          this.dy= -this.dy;
        }

    this.x += this.dx;
    this.y += this.dy;

    this.draw();

  };

  //touch detection
  Circle.prototype.isHitBy= function(x,y,r){
    //a**+b**=c**
    /*
  square root of (mousex -positionX squared) +( mouseY - positionY squared )
    */
  let distance =Math.sqrt(Math.pow(x- this.x,2)+Math.pow(y - this.y,2));
  return distance <= this.radius;
  };

  var circleArray = [] ;

  function babies ()
  {
    for (var i = 0; i < 5; i++) {
      let radius = 50;
      let x= Math.random() *(canvas.width - radius*2)+ radius;
      let y = Math.random() *(canvas.height - radius*2)+ radius;
      let dx = Math.random() * -0.5 *5;
      let dy = Math.random() * -0.5 *5;
      let clr = 'red';
    //var numText = '' ;
    var circle =new Circle(i,x,y,dx,dy,radius,clr);
    //  var circle = new Circle(200,200,3,4,40);
      circleArray.push( circle);

    }
  }
  babies();
  ///event mouse down deletes the circle
  canvas.addEventListener('click', function(e) {
    let mX=( e.clientX- c.canvas.offsetLeft)  ;
    let mY= (e.clientY- c.canvas.offsetTop)  ;

    let canvasBounds = canvas.getBoundingClientRect();
    let clickX = e.pageX - canvasBounds.left;
    let clickY = e.pageY - canvasBounds.top;
    for (var i = 0; i < circleArray.length; i++) {
    if(circleArray[i].isHitBy(clickX,clickY)){
      console.log("resasre",i);
      let  target=circleArray[i];
      target.clr='green';

      target.radius += 10;
      let n=i;
      console.log (`${n}  ${i}`)
    setTimeout(function(){

  circleArray.splice(n,1)
  }, 100);

  if(score<500){
   score += 25;
   document.getElementById('status').innerHTML = `Score: ${score}`
      //target.radius=0;
    }else {
      score = 5;
      document.getElementById('status').innerHTML = `Score: ${score}`
    } ///target.pop();

    setTimeout(function(){

  newBubbles();
  }, 500);

    }
  }


  });

  function newBubbles(){
    if (circleArray === undefined || circleArray.length == 0) {
      babies();
      console.log('BABIES!!!!!1');
  }else {console.log('No babies :(');}

  }
  //animates the circle

  function animate () {

      requestAnimationFrame(animate);
      c.clearRect(0,0,innerWidth, innerHeight);
      for (var i = 0; i < circleArray.length; i++) {
        circleArray[i].update();
        //console.log(circleArray[1].x)
      }


  }


  animate();

  console.log(circleArray)


  </script>
</body>
</html>
